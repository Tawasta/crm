<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="crm_activity_log_event" model="ir.actions.act_window">
        <field name="name">Log an Activity</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">calendar.event</field>
        <field name="view_mode">form</field>
        <field name="context">{'default_duration': 4.0, 'default_opportunity_id': active_id}</field>
        <field name="target">new</field>
    </record>

	<record id="crm_case_form_view_oppor" model="ir.ui.view">
		<field name="name">crm.case.form.view.opportunity.calendar</field>
		<field name="model">crm.lead</field>
		<field name="inherit_id" ref="crm.crm_case_form_view_oppor" />
		<field name="arch" type="xml">

            <xpath expr="//button[@class='btn-link']" position="replace">
                <button  name="%(crm_opportunity_calendar_event.crm_activity_log_event)d"
                         string="Log Activity"
                         type="action"
                         class="btn-link"
                         attrs="{'invisible': [('active', '=', False)]}"/>

            </xpath>

			<field name="date_deadline" position="before">
                <label for="next_event_id"/>
                <div class="o_row mr16" id="next-event-div">
                    <field name="next_event_id"
                           context="{
                           'default_opportunity_id': active_id,
                           'default_name': name,
                           }"
                           domain="[('opportunity_id', '=', active_id)]"
                    />
                    <field name="next_event_start" nolabel="1" />
                    <field name="next_event_duration" widget="float_time" nolabel="1" />
                </div>
			</field>

            <xpath expr="//label[@for='next_activity_id']"  position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//label[@for='next_activity_id']/following-sibling::div" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

		</field>
	</record>

</odoo>